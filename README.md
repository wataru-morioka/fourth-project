## Androidアプリ（別途「third-project」リポジトリ）のバックグラウンド
### 概要
- 複数のAPサーバとDBサーバとその他関連サーバをDockerで構築し、Kubernetes（for Mac）で管理  
- firebaseを利用したプッシュ通知  
### サーバ一覧
- APサーバ4種  
  - 認証、セッション管理、アカウント管理用gRPCサーバ（Go）  
  - 更新データ参照、クライアントへ送信用gRPCサーバ（Go）  
  - メッセージングサーバに格納された新規質問、回答を非同期に随時取得し、DBを更新するバッチサーバ（Go）  
  - 回答結果集計、データ整理、各イベント時プッシュ通知用バッチサーバ（Go）  
- DBサーバ2種  
  - Oracle（アプリケーションのメインデータ用）  
  - Redis2台分散構成（セッション管理用）  
- Redis負荷分散用中継サーバ（Twemproxy）  
- メッセージングサーバ2台同期構成（RabbitMQ）  
- リバースプロキシサーバ（Nginx）  
- Docker管理（Kuberbetes for Mac）  
※各Dockerに充てるリソース制限に関しては未学習  
※マルチノード構成に関しては未学習  
- ログ転送（Fluentd）、集積（ElasticSarch）、GUI管理 （Kibana）  
※単に集積を確認できるだけでほとんど未学習  
- リソースモニタリング（Prometheus）、GUI（Grafana）  
※単にリソース状況を見れるだけでほとんど未学習  
- IPSサーバ（Suricata）、ファイル監視サーバ（TripWire）  
※単に導入して少し試したのみでほとんど未学習  
### 機能一覧
- アカウント認証機能  
- アカウント更新機能  
- キャッシュサーバと連携しセッション管理（redisは2台負荷分散構成）  
- キャッシュサーバのプロキシとして、Twemproxyを使用  
- DB処理はできる限りマルチスレッドで並行処理  
- Go言語並行処理管理  
- DBトランザクション処理  
- DBの更新を監視し、最新データをクライアントに送信  
- クライアントとの通信はgRPC通信（双方向もあり）  
- gRPC通信をTLSでラップ（自己認証局による自己サーバ証明書使用）  
- RabbitMQにて新規質問、回答を受信し、キューに格納（AMQPはTLSでラップ）  
- consumeサーバがRabbiMQのキューから随時データを取得し、DBに登録  
- メッセージングサーバは2台同期クラスタリング構成  
- DB更新を随時監視し、各イベント時クライアントにプッシュ通知（firebase利用）  
- 制限時間を過ぎた質問の集計をし、DBを更新するバッチ処理  
- 不要になったデータを削除整理するバッチ処理  
- Nginxはアクセスロギングをし、各サーバにフォワーディング  
- サーバに対する負荷分散はKuberbetesのNodePortを使用  
- 各サーバのヘルスチェック、復元をKubernetesで管理  
※キャッシュサーバがダウンした場合は、クライアントにアプリ再起動を促す  
※Nginx、各APサーバは随時自動で復旧し、アプリが正常に稼働することを確認  
- TODO  
  - APサーバ複数台構成対応  
  - Oracleサーバ冗長構成  
  - RabbitMQのダウン復旧対応  
  - APとDBとの通信暗号化  
  - 通信暗号化以外のセキュリティ対策  
  - DBのデータ暗号化  
  - ログ管理  
  - リロースモニタリング  
  - Kubernetesリソース管理、マルチノード対応、Ingress利用、認証関連等  
